package ckb_sdk_go

import (
	"encoding/hex"
	"testing"
)

func Test_TxHash(t *testing.T) {
	builder := new(TransactionBuilder).
		SetVersion(23).
		AppendOutput(CellOutput{
			Capacity:5000,
			Data:[]byte{1,2,3},
			Lock:Script{},
			Type_:nil,
	}).
	AppendInput(CellInput{
		Previous_output:OutPoint{
			Block_hash:nil,
			Cell: &CellOutPoint{
				Tx_hash: "01",
				Index:0,
			},

		},
		Since:123,
	}).
	AppendWitness([][]byte{[]byte{7, 8, 9}}).
	Build()
// byte   170000000000000000000000010000000000000001420000000000000030783030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303000000000007B0000000000000001000000000000000088526A740000000300000000000000010203000000000000000042000000000000003078303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030300000000000
// hash 33b4e5e7dfd28956f09dadb18073d979f23aabe397b79cfb7e8db580cc4917b3

//witness 170000000000000000000000010000000000000001420000000000000030783030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303000000000007B0000000000000001000000000000000088526A740000000300000000000000010203000000000000000042000000000000003078303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030300000000000010000000000000001000000000000000300000000000000070809
//witness_hash afa16324fed1fa3b9efa3e11fa0588a01ca8a33342e8844f729b5905697cb350
	expected := "6e9d9e6a6d5be5adafe7eac9f159b439cf4a4a400400cf98c231a341eb318bc2"
	hash := builder.TxHash()
	hashStr := hex.EncodeToString(hash[:])
	if hashStr != expected {
		t.Errorf("expect %s but got %s", expected, hashStr)
	}
}
